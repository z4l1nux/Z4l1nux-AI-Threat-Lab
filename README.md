# Z4l1nux AI Threat Lab

## Descri√ß√£o

Plataforma avan√ßada de modelagem de amea√ßas que utiliza m√∫ltiplos provedores de IA e RAG (Retrieval-Augmented Generation) para:
- An√°lise STRIDE automatizada com mapeamento CAPEC
- **Editor Visual de Diagramas** (DFD drag-and-drop)
- **Detec√ß√£o autom√°tica de componentes IA/ML**
- Sugest√µes de mitiga√ß√µes contextualizadas
- Relat√≥rios completos em PDF + √Årvores de Ataque

## ‚ö° Novidades Principais

### üé® Editor Visual de Diagramas
- **Drag-and-drop** de 46 assets pr√©-definidos (AI/ML, Data, Storage, Services, etc.)
- **3 templates prontos**: LLM Chatbot, Web App, ML Pipeline
- **Trust Boundaries visuais**: External, Internal, DMZ, Third-party
- **An√°lise autom√°tica de fluxos**: Detecta cross-boundary e dados n√£o criptografados
- **Exporta√ß√£o/Importa√ß√£o** de diagramas em JSON

![Editor Visual de Diagramas](src/pictures/visualEditor.png)
*Editor visual com drag-and-drop, trust boundaries e an√°lise autom√°tica de fluxos*

### ü§ñ Threat Modeling com IA
- **Detec√ß√£o autom√°tica de IA/ML**: Keywords de LLM, RAG, ML Pipeline, etc.
- **RAG com Queries Paralelas**: 5 queries simult√¢neas (STRIDE, componentes, tech, integra√ß√µes, IA)
- **Base de conhecimento especializada**:
  - OWASP LLM Top 10 (2025)
  - AI TRiSM Framework (Gartner)
  - AI Regulations (EU AI Act, GDPR, LGPD)
  - AI Blind Spots & Challenges
- **Framework contextual**: OWASP LLM (LLM01-10) para IA, OWASP Web (A01:2021) para tradicional
- **An√°lise de fluxos**: Amea√ßas espec√≠ficas para data flows e trust boundaries

## Arquitetura

### Stack Tecnol√≥gica
- **Frontend**: React 19 + TypeScript + Vite + TailwindCSS
- **Visual Editor**: ReactFlow (node-based diagrams)
- **Backend**: Node.js + Express + TypeScript
- **IA**: Ollama (local) + OpenRouter (cloud)
- **Banco de Dados**: Neo4j (vetorial + grafos)
- **RAG**: Busca sem√¢ntica com embeddings + cache inteligente

### üîå Provedores de IA - Arquitetura Extens√≠vel

O sistema possui uma **arquitetura modular e extens√≠vel** que facilita a adi√ß√£o de novos providers de IA.

#### Providers Dispon√≠veis

| Provider | Status | Gera√ß√£o | Embeddings |
|----------|--------|---------|------------|
| **Ollama** | ‚úÖ Ativo | ‚úÖ Sim | ‚úÖ Sim |
| **OpenRouter** | ‚úÖ Ativo | ‚úÖ Sim | ‚ùå N√£o |
| **Gemini** | ‚úÖ Ativo | ‚úÖ Sim | ‚úÖ Sim |

#### Configura√ß√£o

**1. Ollama (Recomendado - Local)**
```env
OLLAMA_BASE_URL=http://172.21.112.1:11434
MODEL_OLLAMA=llama3.1:latest
EMBEDDING_MODEL_OLLAMA=nomic-embed-text:latest
OLLAMA_TIMEOUT=180000
```

**2. OpenRouter (Cloud - Fallback)**
```env
OPENROUTER_API_KEY=sk-or-v1-...
MODEL_OPENROUTER=meta-llama/llama-3.3-70b-instruct:free
EMBEDDING_MODEL_OPENROUTER=text-embedding-3-small
```

**3. Gemini (Google - Opcional)**
```env
GEMINI_API_KEY=AIza...
MODEL_GEMINI=gemini-1.5-flash
EMBEDDING_MODEL_GEMINI=text-embedding-004
```

**4. Configura√ß√£o Global de Embeddings (Flex√≠vel)**
```env
# Escolha o provider de embeddings (ollama, gemini, openrouter)
EMBEDDING_PROVIDER=ollama
EMBEDDING_MODEL=nomic-embed-text:latest
```

> üí° **Dica**: Voc√™ pode usar **providers diferentes** para gera√ß√£o de texto e embeddings!  
> Exemplo: `MODEL_PROVIDER=openrouter` + `EMBEDDING_PROVIDER=ollama`

#### üöÄ Adicionar Novo Provider

√â extremamente simples adicionar um novo provider (Anthropic, OpenAI, Cohere, etc.):

1. **Copie o template:**
   ```bash
   cd backend/src/core/models/providers
   cp TemplateProvider.ts AnthropicProvider.ts
   ```

2. **Implemente 3 m√©todos:**
   - `isAvailable()` - Verifica se est√° configurado
   - `generateContent()` - Gera texto
   - `generateEmbedding()` - Gera embeddings (ou lan√ßa erro)

3. **Registre no ModelFactory:**
   ```typescript
   const anthropicProvider = new AnthropicProvider();
   this.registerProvider(anthropicProvider);
   ```

4. **Configure o .env:**
   ```env
   ANTHROPIC_API_KEY=sk-ant-xxxxx
   MODEL_ANTHROPIC=claude-3-5-sonnet-20241022
   ```

5. **Pronto!** O sistema detecta e usa automaticamente. üéâ

üìñ **Documenta√ß√£o completa**: [`ARQUITETURA_PROVIDERS.md`](ARQUITETURA_PROVIDERS.md) e [`backend/src/core/models/providers/README.md`](backend/src/core/models/providers/README.md)

### Sistema RAG Avan√ßado
- **Queries Paralelas**: 5 queries simult√¢neas para an√°lise completa
- **Deduplica√ß√£o inteligente**: Por chunk e vers√£o de documento
- **Busca Vetorial**: Neo4j com √≠ndices otimizados (768 dimens√µes)
- **Cache com TTL**: Reduz lat√™ncia em 80%
- **Formatos**: PDF, DOCX, DOC, TXT, MD, XML, JSON, CSV

## Pr√©-requisitos

- Node.js 18+
- Docker + Docker Compose (para Neo4j)
- **Pelo menos um provedor de IA:**
  - Ollama: Instala√ß√£o local (https://ollama.ai)
  - OpenRouter: Conta + API key (https://openrouter.ai)

> **‚ö†Ô∏è IMPORTANTE - Arquivo de Configura√ß√£o:**  
> Este projeto usa **APENAS** o arquivo `.env.local` localizado na **raiz do projeto**.  
> **N√ÉO** crie arquivos `.env` dentro da pasta `backend/`.  
> O backend carrega automaticamente as vari√°veis de `../env.local` (raiz do projeto).

## Instala√ß√£o

1. **Clone o reposit√≥rio:**
   ```bash
   git clone <url-do-repo>
   cd z4l1nux-ai-threat-lab
   ```

2. **Instale as depend√™ncias:**
   
   **Linux/Mac (Bash):**
   ```bash
   npm install
   ```
   
   **Windows (PowerShell):**
   ```powershell
   npm install
   ```
   
   **Ou use o script autom√°tico:**
   ```bash
   # Linux/Mac
   ./scripts/setup.sh
   
   # Windows
   .\scripts\setup.ps1
   ```

3. **Configure o `.env.local` (na raiz do projeto):**
   ```bash
   # Copie o template (se existir)
   cp .env.example .env.local
   
   # Ou crie manualmente com:
   ```
   
     ```env
   # Neo4j (OBRIGAT√ìRIO)
     NEO4J_URI=bolt://localhost:7687
     NEO4J_USER=neo4j
     NEO4J_PASSWORD=sua_senha_segura_aqui
     
   # Ollama (Local - Recomendado)
   OLLAMA_BASE_URL=http://localhost:11434
   MODEL_OLLAMA=llama3.1:latest
   EMBEDDING_MODEL_OLLAMA=nomic-embed-text:latest
   OLLAMA_TIMEOUT=180000
   
   # OpenRouter (Cloud - Opcional)
   OPENROUTER_API_KEY=
   MODEL_OPENROUTER=meta-llama/llama-3.3-70b-instruct:free
   EMBEDDING_MODEL_OPENROUTER=text-embedding-3-small
   
   # Gemini (Google - Opcional)
   GEMINI_API_KEY=
   MODEL_GEMINI=gemini-1.5-flash
   EMBEDDING_MODEL_GEMINI=text-embedding-004
   
   # Embedding Configuration
   EMBEDDING_PROVIDER=ollama
     EMBEDDING_MODEL=nomic-embed-text:latest
     
   # Server
   PORT=3001
   BACKEND_PORT=3001
   FRONTEND_URL=http://localhost:5173
   ```

4. **Inicie o Neo4j:**
   ```bash
   docker-compose up -d
   ```

## Uso

### Iniciar o Sistema

```bash
# Recomendado: Backend + Frontend juntos
npm run dev:full

# Ou separadamente:
npm run dev:backend  # Terminal 1
npm run dev          # Terminal 2
```

Acesse: `http://localhost:5173`

### Fluxo de Uso

#### Op√ß√£o 1: Editor Visual (Recomendado para sistemas novos)

1. **Acesse a tab "Editor Visual de Diagramas"**
2. **Escolha um template** ou **arraste assets** da biblioteca
3. **Configure trust boundaries** (External, Internal, DMZ, Third-party)
4. **Conecte os componentes** (data flows)
5. **Clique em "Analisar Amea√ßas"** ‚Üí Sistema gera an√°lise completa

#### Op√ß√£o 2: Formul√°rio de Texto (Para sistemas existentes)

1. **Inicialize o RAG** (Painel esquerdo ‚Üí "Inicializar Sistema")
2. **Fa√ßa upload da base de conhecimento:**
   - `capec-stride-mapping-completo.md` (mapeamento STRIDE-CAPEC)
   - `OWASP-LLM-Top-10.md` (amea√ßas LLM)
   - `AI-TRiSM-Framework.md` (framework IA)
   - Outros documentos relevantes
3. **Preencha o formul√°rio** com descri√ß√£o do sistema

### Visualizar Resultados

- **Tabela de Amea√ßas**: STRIDE + CAPEC + Mitiga√ß√µes + OWASP Top 10/LLM
- **√Årvore de Ataque Interativa**: Diagrama Mermaid com zoom/pan
- **Exportar PDF**: Relat√≥rio completo para compartilhar
- **Refinar com IA**: An√°lise adicional contextualizada

## Funcionalidades Principais

### Editor Visual de Diagramas
- **46 Assets Pr√©-definidos**:
  - AI/ML: LLM Model, Vector DB, ML Pipeline, Training Data
  - Data: Database, Cache, Data Lake, Message Queue
  - Storage: Object Storage, File Storage, Backup
  - Services: Web App, Backend, Microservice, API Gateway
  - External: Third-party API, Cloud Service, CDN
  - Users: End User, Admin, Data Scientist, Developer
- **Templates Prontos**: LLM Chatbot, Web App, ML Pipeline
- **Trust Boundaries**: Visualiza√ß√£o de zonas de confian√ßa
- **An√°lise Autom√°tica**: Detecta fluxos cross-boundary e dados n√£o criptografados

### An√°lise de Amea√ßas com IA
- **Detec√ß√£o de IA/ML**: Identifica automaticamente LLM, RAG, ML, embeddings, etc.
- **STRIDE Completo**: Garante todas as 6 categorias (Spoofing, Tampering, etc.)
- **CAPEC √önicos**: 85%+ de unicidade, sem repeti√ß√µes
- **Framework Contextual**: 
  - OWASP LLM (LLM01-10) para componentes de IA
  - OWASP Web (A01:2021-A10:2021) para componentes tradicionais
- **An√°lise de Fluxos**: Amea√ßas espec√≠ficas para data flows e trust boundaries

### Sistema RAG Avan√ßado
- **Queries Paralelas**: 5 aspectos simult√¢neos (geral, componentes, tech, integra√ß√µes, IA)
- **Base de Conhecimento Especializada**:
  - OWASP LLM Top 10 (2025)
  - AI TRiSM Framework (Gartner)
  - AI Regulations (EU AI Act, GDPR, LGPD)
  - CAPEC-STRIDE Mapping (400+ CAPECs)
- **Cache Inteligente**: TTL configur√°vel, reduz lat√™ncia
- **Busca Vetorial**: Neo4j com √≠ndices otimizados

![Arquitetura RAG](src/pictures/rag-arch.jpg)
*Arquitetura do sistema RAG com Neo4j, busca vetorial e cache inteligente*

## Estrutura do Projeto

```
z4l1nux-ai-threat-lab/
‚îú‚îÄ‚îÄ src/                              # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VisualEditor/            # üé® Editor Visual
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VisualEditor.tsx     # Editor principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AssetLibrary.tsx     # Biblioteca de assets
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomNode.tsx       # N√≥ customizado
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrustBoundaryNode.tsx # N√≥ de trust boundary
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TemplateSelector.tsx # Seletor de templates
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SystemInputForm.tsx      # Formul√°rio de texto
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReportDisplay.tsx        # Tabela de amea√ßas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RAGPanel.tsx             # Painel RAG
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ModelSelector.tsx        # Seletor de modelos
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assetLibrary.ts          # 46 assets pr√©-definidos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ diagramTemplates.ts      # 3 templates prontos
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aiService.ts             # ü§ñ Servi√ßo de IA (detec√ß√£o + RAG paralelo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aiThreatsKnowledgeBase.ts # Detec√ß√£o de IA/ML
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ragService.ts            # Servi√ßo RAG
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ visual.ts                # Tipos do editor visual
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ diagramConverter.ts      # Converte diagrama ‚Üí SystemInfo
‚îú‚îÄ‚îÄ backend/src/
‚îÇ   ‚îú‚îÄ‚îÄ server.ts                    # Express server + endpoints
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                  # üîå Sistema de Providers (Extens√≠vel)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModelProvider.ts     # Interface base
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModelFactory.ts      # Auto-registro e fallback
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ README.md        # üìñ Guia completo
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TemplateProvider.ts # Template documentado
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ OllamaProvider.ts   # Ollama (local)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ OpenRouterProvider.ts # OpenRouter (cloud)
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ GeminiProvider.ts    # Gemini (Google)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search/                  # Busca sem√¢ntica
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache/                   # Cache manager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ graph/                   # Neo4j client
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îú‚îÄ‚îÄ initNeo4j.ts             # Inicializa√ß√£o Neo4j
‚îÇ       ‚îî‚îÄ‚îÄ testRAG.ts               # Teste RAG
‚îú‚îÄ‚îÄ src/knowledge-base/              # üìö Base de conhecimento
‚îÇ   ‚îú‚îÄ‚îÄ OWASP-LLM-Top-10.md         # Amea√ßas LLM (636 linhas)
‚îÇ   ‚îú‚îÄ‚îÄ AI-TRiSM-Framework.md       # Framework IA (501 linhas)
‚îÇ   ‚îú‚îÄ‚îÄ AI-Regulations-Compliance.md # Regula√ß√µes IA (200+ linhas)
‚îÇ   ‚îú‚îÄ‚îÄ AI-Blind-Spots-Challenges.md # Desafios IA (150+ linhas)
‚îÇ   ‚îî‚îÄ‚îÄ capec-stride-mapping-completo.md # 400+ CAPECs (613 linhas)
‚îú‚îÄ‚îÄ docker-compose.yml               # Neo4j container
‚îî‚îÄ‚îÄ test-rag.sh                      # Testes de integra√ß√£o
```

## Testes

### Testes Unit√°rios
```bash
npm test                # Executar testes
npm run test:ui         # Interface UI
npm run test:coverage   # Relat√≥rio de cobertura
```

### Testes de Integra√ß√£o
```bash
npm run test:integration  # Testes E2E
./test-rag.sh            # Testes RAG completos
```

## Documenta√ß√£o

### üìö Geral
- **[ARQUITETURA_PROVIDERS.md](ARQUITETURA_PROVIDERS.md)** - üîå Sistema extens√≠vel de providers de IA

### üß™ Testes e Valida√ß√£o
- **[TESTES.md](src/__tests__/TESTES.md)** - Guia completo de testes
- **[QUERIES_NEO4J.md](src/__tests__/QUERIES_NEO4J.md)** - Queries Cypher √∫teis
- **[GUIA_RAPIDO_NEO4J.md](src/__tests__/GUIA_RAPIDO_NEO4J.md)** - Top 5 queries + troubleshooting
- **[VALIDACAO_RAG.md](src/__tests__/VALIDACAO_RAG.md)** - Evid√™ncias de funcionamento do RAG

### üîå Desenvolvimento de Providers
- **[backend/src/core/models/providers/README.md](backend/src/core/models/providers/README.md)** - Guia completo para criar providers
- **[backend/src/core/models/providers/TemplateProvider.ts](backend/src/core/models/providers/TemplateProvider.ts)** - Template documentado com exemplos

## Configura√ß√µes Avan√ßadas

### Timeout e Retries
```env
OLLAMA_TIMEOUT=180000        # 3 minutos (padr√£o)
OLLAMA_MAX_RETRIES=2         # 2 tentativas
```

Para prompts complexos, aumente o timeout:
- **Complexo**: 300s (5 min) ‚Üí `OLLAMA_TIMEOUT=300000`
- **Muito Complexo**: 600s (10 min) ‚Üí `OLLAMA_TIMEOUT=600000`

### Cache e Performance
```env
RESPONSE_CACHE_TTL_MS=300000   # 5 minutos (cache de respostas)
RETRIEVAL_CACHE_TTL_MS=300000  # 5 minutos (cache de embeddings)
```

## Exemplo de Prompt Completo

**Sistema:** HealthConnect

**Descri√ß√£o:** Plataforma de telemedicina com:
- **Componentes:** Portal Paciente (Web/M√≥vel), Portal M√©dico, API Central, Servi√ßos de Agendamento, Teleconsulta (WebRTC), PEP, Prescri√ß√£o Digital
- **Dados:** MongoDB (perfis), PostgreSQL (dados cl√≠nicos criptografados)
- **Integra√ß√µes:** Gateways de pagamento, SMS/E-mail, Assinatura digital
- **Tecnologias:** Vue.js, Flutter, Python, Golang, WebRTC, Kafka, Docker, Kubernetes (Azure)
- **Seguran√ßa:** TLS 1.3, E2E encryption, X.509 certificates
- **Dados Cr√≠ticos:** Prontu√°rios, hist√≥rico m√©dico, CPF, credenciais, tokens de pagamento

## Licen√ßa

MIT License - Veja [LICENSE](LICENSE) para detalhes.

**Resumo:**
- ‚úÖ Uso comercial, modifica√ß√£o, distribui√ß√£o permitidos
- ‚ö†Ô∏è Sem garantias de funcionamento
- üìã Incluir copyright e licen√ßa ao redistribuir

---

**Desenvolvido por Z4l1nux**
