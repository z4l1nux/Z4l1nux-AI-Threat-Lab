# Z4l1nux AI Threat Lab

O **Z4l1nux AI Threat Lab** √© um laborat√≥rio avan√ßado de an√°lise de amea√ßas cibern√©ticas que implementa um sistema de Retrieval-Augmented Generation (RAG) em **TypeScript Full-Stack** com recursos avan√ßados de controle de vers√£o, cache inteligente e processamento incremental. O sistema √© especializado em an√°lise de threat modeling, detec√ß√£o de vulnerabilidades e gera√ß√£o de relat√≥rios de seguran√ßa automatizados, suportando modelos locais via Ollama e modelos remotos via OpenRouter (DeepSeek).

## üéØ **Nova Arquitetura Full-Stack TypeScript**

- **Frontend:** React 18 + TypeScript + Vite
- **Backend:** Node.js + Express + TypeScript  
- **Database:** Neo4j com suporte vetorial
- **IA:** Ollama (local) + OpenRouter (cloud)
- **Build:** TypeScript compilado + Vite bundling

## ‚ú® Funcionalidades do Z4l1nux AI Threat Lab

### üöÄ **Neo4j - Base de Dados de Grafos com Suporte Vetorial**
- **Performance Superior**: Busca vetorial e de grafos otimizada para an√°lise de amea√ßas
- **Escalabilidade**: Suporta milh√µes de n√≥s e relacionamentos de vulnerabilidades
- **Persist√™ncia Robusta**: Base de dados ACID com backup autom√°tico de dados de seguran√ßa
- **Flexibilidade**: Suporte a vetores, grafos e metadados complexos de threat modeling
- **Integra√ß√£o Nativa**: Compat√≠vel com LangChain e frameworks modernos de IA

### üíæ **Cache Inteligente com Neo4j para Dados de Seguran√ßa**
- Armazenamento persistente de embeddings de documentos de seguran√ßa no Neo4j
- Cache por documento com metadados flex√≠veis de threat modeling
- Estat√≠sticas detalhadas de uso de an√°lises de amea√ßas
- Limpeza seletiva de cache de dados de seguran√ßa
- Backup autom√°tico e recupera√ß√£o de dados cr√≠ticos

### üîç **Busca Sem√¢ntica Otimizada para An√°lise de Amea√ßas**
- Similaridade por cosseno implementada para documentos de seguran√ßa
- Filtros de qualidade de resultados de threat modeling
- Busca otimizada com √≠ndices vetoriais do Neo4j para vulnerabilidades
- Performance 10-100x superior ao sistema anterior de an√°lise de amea√ßas

## üß≠ Arquitetura do Z4l1nux AI Threat Lab

![RAG Architecture Model](docs/images/rag-architecture-model.jpg)

### Fluxo Principal do Sistema de An√°lise de Amea√ßas

```mermaid
flowchart TB
    %% User Interface
    UI[üåê Web Interface] --> API[üì° REST API]
    
    %% Core Processing
    API --> QP[üîç Question Processor]
    QP --> VS[üß† Vector Search]
    
    %% Database Layer
    VS --> NEO[(üóÇÔ∏è Neo4j<br/>Graph Database)]
    NEO --> EMB[üìä Embeddings<br/>nomic-embed-text]
    
    %% LLM Processing
    VS --> LLM{ü§ñ LLM Selection}
    LLM -->|Local| OLL[ü¶ô Ollama<br/>A sua escolha]
    LLM -->|Remote| OR[‚òÅÔ∏è OpenRouter<br/>A sua escolha]
    
    %% Document Processing
    DOC[üìÑ Security Document Upload] --> SEC[üîí Security Check]
    SEC --> PROC[‚öôÔ∏è Threat Document Processor]
    PROC --> NEO
    
    %% Response Generation
    OLL --> RG[üìù Threat Analysis Generator]
    OR --> RG
    RG --> TM[üéØ Threat Model Report]
    TM --> UI
    
    %% Styling
    classDef database fill:#e1f5fe
    classDef llm fill:#f3e5f5
    classDef security fill:#ffebee
    classDef processing fill:#e8f5e8
    
    class NEO database
    class OLL,OR,LLM llm
    class SEC security
    class QP,VS,PROC,RG processing
```

### Fluxo de Processamento

1. **Ingest√£o**: Documentos s√£o processados e divididos em chunks
2. **Embedding**: Cada chunk gera embedding vetorial
3. **Cache**: Embeddings s√£o armazenados no Neo4j
4. **Busca**: Consultas s√£o convertidas em embeddings e buscadas por similaridade
5. **Cache de Query**: Embeddings de consultas s√£o cacheados

## üöÄ Pr√©-requisitos

- Node.js (vers√£o 18 ou superior)
- npm ou yarn
- Ollama (para uso local)
- Docker (para Neo4j)

## üì¶ Instala√ß√£o

### **üöÄ Setup Autom√°tico (Recomendado)**

#### **Linux/macOS:**
```bash
./scripts/setup.sh
```

#### **Windows:**
```powershell
.\scripts\setup.ps1
```

### **üîß Setup Manual**

1. Instale as depend√™ncias do backend:
```bash
npm install
```

2. Instale as depend√™ncias do frontend:
```bash
cd src/client
npm install
cd ../..
```

3. Configure as vari√°veis de ambiente:
```bash
# Copie o arquivo de exemplo
cp .env.example .env

# Edite o arquivo .env com suas configura√ß√µes
nano .env
```

**Exemplo de configura√ß√£o (.env):**
```bash
# Configura√ß√µes do Ollama (para modelos locais)
OLLAMA_BASE_URL=http://127.0.0.1:11434
MODEL_OLLAMA=qwen2.5-coder:7b
EMBEDDING_MODEL=nomic-embed-text:latest

# Configura√ß√µes do OpenRouter (para modelos remotos)
OPENROUTER_API_KEY=sua_chave_openrouter_aqui
MODEL_OPENROUTER=meta-llama/llama-3.3-70b-instruct:free

# Configura√ß√µes do Neo4j
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password

# Configura√ß√µes do servidor web
PORT=3000

# Configura√ß√µes de cache
RESPONSE_CACHE_TTL_MS=300000
RETRIEVAL_CACHE_TTL_MS=300000

# Modo de busca (neo4j)
SEARCH_MODE=neo4j
```

## ‚öôÔ∏è Configura√ß√£o do Ollama

1. Instale o Ollama seguindo as instru√ß√µes em: https://ollama.ai/

2. Baixe os modelos necess√°rios:
```bash
# Modelo de chat
ollama pull qwen2.5-coder:7b

# Modelo de embeddings
ollama pull nomic-embed-text
```

3. Inicie o servidor Ollama:
```bash
ollama serve
```

## üóÑÔ∏è Configura√ß√£o do Neo4j (Opcional)

Para usar busca vetorial e de grafos, configure o Neo4j:

### Docker Compose (Recomendado)

O projeto j√° inclui um arquivo `docker-compose.yml` configurado. Execute:

```bash
docker-compose up -d
```

**Vers√µes dispon√≠veis:**
- **Est√°vel**: `neo4j:5.14.0-community` (padr√£o)
- **Mais recente**: `neo4j:5.26.12-community-ubi9` (altere no docker-compose.yml)

### Acessar Neo4j Browser

Ap√≥s iniciar o container, acesse:
- **Neo4j Browser**: http://localhost:7474
- **Usu√°rio**: neo4j
- **Senha**: password

### üìö **Documentos CAPEC-STRIDE Recomendados (Importar Primeiro)**

Para obter os melhores resultados de threat modeling, **importe primeiro** os seguintes documentos CAPEC-STRIDE na base de conhecimento:

#### **1. Mapeamento CAPEC-STRIDE (Obrigat√≥rio)**
- **Fonte**: [CAPEC S.T.R.I.D.E. Mapping](https://www.ostering.com/media/files/docs/capec-stride-mapping.md)
- **Conte√∫do**: Mapeamento completo de padr√µes de ataque CAPEC para categorias STRIDE
- **Benef√≠cio**: Permite ao sistema identificar automaticamente CAPECs relevantes para cada tipo de amea√ßa STRIDE

#### **2. Base Oficial CAPEC do MITRE (Recomendado)**
- **Fonte**: [CAPEC Downloads](https://capec.mitre.org/data/downloads.html)
- **Documentos sugeridos**:
  - **Mechanisms of Attack**: `Booklet.html`, `CSV.zip`, `XML.zip`
  - **Domains of Attack**: `Booklet.html`, `CSV.zip`, `XML.zip`
- **Benef√≠cio**: Base completa e atualizada de padr√µes de ataque oficiais

#### **3. Como Importar**
1. Baixe os documentos das fontes acima
2. Use a interface web para fazer upload dos arquivos
3. Aguarde o processamento e indexa√ß√£o
4. Verifique o status da base de conhecimento

**Importante**: Estes documentos devem ser importados **antes** dos documentos espec√≠ficos do sistema que ser√° modelado, pois fornecem o contexto fundamental de padr√µes de ataque e metodologia STRIDE.

### üìÅ Tipos de Arquivo de Seguran√ßa Suportados

O Z4l1nux AI Threat Lab suporta os seguintes tipos de arquivo para an√°lise de amea√ßas:

#### ‚úÖ Formatos de Documentos de Seguran√ßa Suportados
- **PDF**: Leitura e processamento completo de relat√≥rios de seguran√ßa via LangChain PDFLoader
- **XML**: Leitura e parsing de documentos de threat modeling via XMLLoader personalizado
- **JSON**: Leitura e parsing de dados de vulnerabilidades via JSONLoader personalizado  
- **CSV**: Leitura e parsing de listas de amea√ßas via CSVLoader personalizado
- **Markdown (.md/.markdown)**: Leitura de documenta√ß√£o de seguran√ßa via `MarkdownLoader`

#### üîß Como Funciona no Threat Lab
Cada tipo de arquivo de seguran√ßa √© processado por um loader espec√≠fico do LangChain:
- **PDF**: Usa o `PDFLoader` nativo para relat√≥rios de seguran√ßa
- **XML**: Converte XML de threat modeling para JSON estruturado
- **JSON**: Processa dados JSON de vulnerabilidades estruturados
- **CSV**: Converte linhas CSV de amea√ßas para objetos JSON

Todos os loaders seguem o padr√£o LangChain e retornam documentos de seguran√ßa com metadados apropriados para an√°lise de amea√ßas.

## üéØ Uso

### **üöÄ Execu√ß√£o em Desenvolvimento**

#### **Scripts Automatizados:**
```bash
# Linux/macOS
./scripts/setup.sh && npm run dev

# Windows
.\scripts\dev.ps1
```

#### **Manual:**
```bash
# Executar aplica√ß√£o completa (backend + frontend)
npm run dev
```

### **üåê Acesso √† Aplica√ß√£o**

#### **Em Desenvolvimento:**
- **Aplica√ß√£o:** http://localhost:3000 (backend serve o React)
- **Frontend Dev:** http://localhost:3001 (Vite - hot reload)
- **Backend API:** http://localhost:3000/api

#### **Em Produ√ß√£o:**
- **Aplica√ß√£o:** http://localhost:3000 (backend serve o build)
- **Backend API:** http://localhost:3000/api

**Nota:** Em desenvolvimento, use `http://localhost:3000` para acessar a aplica√ß√£o. O Vite dev server (3001) √© usado internamente para hot reload.

### **üß™ Testes do Sistema**

```bash
# Testar o sistema RAG completo
npm run test-rag

# Testar os loaders de documentos
npm run test-loaders
```

### Gerenciador de Cache Interativo do Threat Lab

Execute o gerenciador de cache Neo4j para an√°lise de amea√ßas:
```bash
npm run create-neo4j
```

**Op√ß√µes dispon√≠veis para an√°lise de seguran√ßa:**

1. **üîÑ Atualiza√ß√£o Incremental (Recomendado)**
   - Detecta automaticamente mudan√ßas nos documentos de threat modeling
   - Processa apenas documentos de seguran√ßa novos/modificados
   - Mais r√°pido e eficiente para an√°lise de amea√ßas

2. **üîÑ Reprocessamento Completo**
   - Reprocessa todos os documentos de seguran√ßa
   - √ötil para mudan√ßas de configura√ß√£o de an√°lise
   - Mais lento, mas garante consist√™ncia dos dados de amea√ßas

3. **üìä Mostrar Estat√≠sticas de Seguran√ßa**
   - Exibe informa√ß√µes detalhadas do cache de dados de seguran√ßa
   - Total de documentos de threat modeling e chunks
   - Tamanho do cache e datas de an√°lise

4. **üóëÔ∏è Limpar Cache de Seguran√ßa**
   - Remove completamente o cache de dados de amea√ßas
   - √ötil para resetar o sistema de an√°lise

### **üåê Interface Web (Recomendado)**

1. **Iniciar a aplica√ß√£o:**
```bash
npm run dev
```

2. **Acessar no navegador:**
```
http://localhost:3000
```

3. **Funcionalidades da interface:**
   - Escolha entre Ollama (Qwen2.5-Coder:7b) ou OpenRouter (Llama-3.3-70b-Instruct)
   - Upload de documentos para contexto
   - An√°lise de threat modeling automatizada
   - Visualiza√ß√£o de relat√≥rios com diagramas Mermaid
   - Status da base de conhecimento em tempo real

## üèóÔ∏è Arquitetura do Z4l1nux AI Threat Lab

### Estrutura de Diret√≥rios

```
threat-model/
‚îú‚îÄ‚îÄ src/                    # üìÅ C√≥digo fonte principal
‚îÇ   ‚îú‚îÄ‚îÄ client/            # üåê Frontend React + TypeScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/           # Componentes React
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json   # Depend√™ncias do frontend
‚îÇ   ‚îú‚îÄ‚îÄ core/              # üß† L√≥gica principal do sistema
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache/         # üíæ Gerenciadores de cache
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search/        # üîç Busca sem√¢ntica
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ graph/         # üï∏Ô∏è Integra√ß√£o Neo4j
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts       # üìù Tipos principais
‚îÇ   ‚îú‚îÄ‚îÄ shared/            # üîÑ C√≥digo compartilhado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/      # Servi√ßos compartilhados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types/         # Tipos compartilhados
‚îÇ   ‚îú‚îÄ‚îÄ web/               # üåê Backend Express
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.ts      # Servidor web
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # üîß Utilit√°rios
‚îÇ   ‚îî‚îÄ‚îÄ test/              # üß™ Testes
‚îú‚îÄ‚îÄ public/                # üåê Arquivos p√∫blicos
‚îÇ   ‚îî‚îÄ‚îÄ react/             # Build do frontend
‚îú‚îÄ‚îÄ scripts/               # üìú Scripts de automa√ß√£o
‚îú‚îÄ‚îÄ docker-compose.yml     # üê≥ Configura√ß√£o Docker
‚îú‚îÄ‚îÄ package.json           # üìã Depend√™ncias principais
‚îî‚îÄ‚îÄ README.md              # üìñ Documenta√ß√£o
```

### Princ√≠pios de Organiza√ß√£o

- **Separa√ß√£o de Responsabilidades**: Frontend, backend e l√≥gica de neg√≥cio separados
- **C√≥digo Compartilhado**: Tipos e servi√ßos compartilhados entre frontend e backend
- **Modularidade**: Componentes independentes e reutiliz√°veis
- **TypeScript**: Tipagem forte em todo o projeto

## üîß Configura√ß√µes

### Modos de Busca
- **`neo4j`**: Busca vetorial e de grafos (recomendado)

## üöÄ Comandos Principais

### Desenvolvimento
```bash
# Executar aplica√ß√£o completa (backend + frontend)
npm run dev

# Build de produ√ß√£o
npm run build

# Scripts automatizados
./scripts/setup.sh        # Linux/macOS - Setup completo
.\scripts\setup.ps1       # Windows - Setup completo
.\scripts\dev.ps1         # Windows - Desenvolvimento
```

### Gerenciamento de Cache
```bash
# Gerenciador de cache Neo4j
npm run create-neo4j
```

### Testes
```bash
# Testes do sistema RAG
npm run test-rag

# Testes dos loaders de documentos
npm run test-loaders
```

### Vantagens do Sistema:

- **Performance**: 10-100x mais r√°pido na busca
- **Escalabilidade**: Suporte a milh√µes de documentos
- **Confiabilidade**: Backup autom√°tico e recupera√ß√£o
- **Flexibilidade**: Metadados mais ricos e consultas avan√ßadas
- **Busca Neo4j**: Combina busca vetorial com grafos de conhecimento

## üêõ Solu√ß√£o de Problemas

### Erro: "OPENROUTER_API_KEY √© obrigat√≥ria"
```bash
# Copie o arquivo de exemplo e configure
cp .env.example .env
# Edite o arquivo .env e adicione sua chave OpenRouter
```

### Erro: "Banco de dados Neo4j n√£o encontrado"
```bash
# Execute o gerenciador de cache Neo4j
npm run create-neo4j
```

### Erro: "Ollama n√£o est√° rodando"
```bash
# Inicie o servidor Ollama
ollama serve

# Verifique se os modelos est√£o instalados
ollama list

# Se necess√°rio, baixe os modelos
ollama pull qwen2.5-coder:7b
ollama pull nomic-embed-text
```

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudan√ßas
4. Push para a branch
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes. 